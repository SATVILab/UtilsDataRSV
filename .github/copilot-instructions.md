# UtilsDataRSV - GitHub Copilot Instructions

This is an R package repository that provides utility functions to support data pre-processing. The package facilitates tasks like viewing unique data entries by columns and groups, fixing Excel decimal symbol errors, and other miscellaneous data processing tasks.

## Code Standards

### Required Before Each Commit
- Run `R CMD check .` to ensure the package passes all checks
- Ensure all tests pass by running the test suite
- Update documentation if you modify function signatures or behavior

### Development Flow
- **Build package**: `R CMD build .`
- **Check package**: `R CMD check <package-tarball>.tar.gz`
- **Test**: Tests are located in `tests/testthat/` and use the testthat framework
- **Documentation**: Generate documentation with roxygen2 comments in source files

### R Package Standards
- Follow standard R package structure as defined by CRAN
- Use roxygen2 for documentation (RoxygenNote: 7.1.2)
- All exported functions must have `@export` tags in their roxygen documentation
- Include `@examples` in roxygen documentation for all exported functions
- Use `@param` and `@return` tags to document function parameters and return values

## Repository Structure

- `R/`: Core R package source code containing utility functions
  - Functions for data viewing (`view_unique_col_entries.R`, `view_slice.R`)
  - Data transformation utilities (`fix_excel_decimal_symbol_errors.R`)
  - Data manipulation helpers (`cross_df_safe.R`, `filter_based_on_mean_grp_value.R`)
  - Pipe utilities (`utils-pipe.R`)
- `tests/testthat/`: Test files using the testthat framework (edition 3)
  - Test files should be named `test-<function-name>.R`
  - All test files correspond to R files in the `R/` directory
- `man/`: Generated documentation files (do not edit manually, use roxygen2)
- `DESCRIPTION`: Package metadata and dependencies
- `NAMESPACE`: Package namespace (auto-generated by roxygen2, do not edit manually)
- `README.Rmd`: Source file for README (edit this, not README.md)
- `README.md`: Generated from README.Rmd (do not edit directly)
- `.github/workflows/copilot-setup-steps.yml`: CI/CD setup for Copilot environment

## Key Guidelines

### 1. R Coding Style
- Use clear, descriptive variable names
- Prefer explicit parameter names in function calls
- Use `<-` for assignment (not `=`)
- Follow tidyverse style guide conventions where applicable
- Use 2-space indentation
- Keep lines under 80 characters when practical

### 2. Function Development
- Write vectorized functions when possible
- Include input validation and informative error messages
- Use `stop()` for errors, `warning()` for warnings
- Handle `NA` values explicitly
- Document edge cases in function documentation

### 3. Dependencies
- Current package dependencies (from DESCRIPTION):
  - `tibble`: For modern data frames
  - `magrittr`: For pipe operators
  - `stringr`: For string manipulation
  - `dplyr`: For data manipulation
  - `rlang`: For tidy evaluation
- When adding new dependencies:
  - Add to `Imports:` section in DESCRIPTION
  - Use `package::function()` notation in code
  - Minimize new dependencies when possible

### 4. Testing
- Use testthat (>= 3.0.0) framework
- Write tests for all exported functions
- Include tests for edge cases (NA values, empty inputs, etc.)
- Use `expect_identical()`, `expect_true()`, `expect_error()` as appropriate
- Use `expect_output()` to test functions that print to console
- Clean up temporary files in tests

### 5. Documentation
- All exported functions must have complete roxygen2 documentation
- Include `@title`, `@description`, `@param`, `@return`, `@export`, and `@examples`
- Document default parameter values
- Explain any non-obvious behavior
- Keep examples simple and reproducible
- Update `README.Rmd` when adding new major features (then regenerate README.md)

### 6. NAMESPACE Management
- NAMESPACE is auto-generated by roxygen2 - do not edit manually
- Use `@export` to export functions
- Use `@importFrom package function` or `package::function()` for imports
- Re-run roxygen2 documentation generation after changes

### 7. Version Control
- Build artifacts are excluded via .gitignore (*.Rcheck/, *.tar.gz)
- The .Rbuildignore file specifies what to exclude from the package build
- Do not commit generated files (man/*.Rd files are generated from roxygen)

## Common Tasks

### Adding a New Function
1. Create new R file in `R/` directory
2. Write function with roxygen2 documentation
3. Add `@export` tag if function should be public
4. Create corresponding test file in `tests/testthat/`
5. Run `roxygen2::roxygenise()` or equivalent to update documentation
6. Build and check package: `R CMD build .` then `R CMD check <tarball>`

### Modifying Existing Functions
1. Update the function code in `R/` directory
2. Update roxygen2 documentation if signature or behavior changed
3. Update or add tests in corresponding test file
4. Verify tests pass
5. Regenerate documentation if needed
6. Run package check

### Fixing Bugs
1. Add a failing test that reproduces the bug
2. Fix the bug in the source code
3. Verify the test now passes
4. Ensure all other tests still pass
5. Update documentation if the fix changes expected behavior

## Special Considerations

- This package is focused on data preprocessing utilities
- Functions should be simple, focused, and composable
- Performance is secondary to clarity and correctness
- Examples should use base R datasets (mtcars, cars, iris, etc.) when possible
- The package uses MIT license - ensure any contributions are compatible
