# UtilsDataRSV - GitHub Copilot Instructions

R package providing utility functions for data pre-processing: viewing
unique data entries, fixing Excel decimal symbol errors, and other data
processing tasks.

------------------------------------------------------------------------

## Code Quality

- Make minimal, surgical changes to fix issues
- Maintain backward compatibility when possible
- Follow existing patterns in the codebase
- Add tests for new functionality or bug fixes
- Never leave trailing whitespace at the end of lines or on blank lines
- Always add a blank line between headings and bullet points

## Before Committing

- Run `devtools::document()` to update documentation
- Run `devtools::test()` for testing (use LITE mode for faster
  iteration)
- Run `devtools::check()` to ensure package passes R CMD check

## Package Structure

- `R/` - Source code (use `.` prefix for internal functions)
- `tests/testthat/` - Tests (use helper functions from `helper-*.R`)
- `man/` - Auto-generated docs (DO NOT edit directly)
- `DESCRIPTION` - Package metadata and dependencies
- `NAMESPACE` - Auto-generated by roxygen2 (DO NOT edit directly)
- `README.Rmd` - Source for README (edit this, not README.md)
- `_pkgdown.yml` - pkgdown website configuration

------------------------------------------------------------------------

## R Coding Style

- Use `<-` for assignment (not `=`)
- Use 2-space indentation
- Keep lines under 80 characters
- Use clear, descriptive variable names
- Prefer explicit parameter names in function calls

``` r
# ✅ Correct
result <- my_function(data = mtcars, n = 5)

# ❌ Incorrect
result = my_function(mtcars, 5)
```

## Function Development

- Write vectorized functions when possible
- Include input validation with informative error messages
- Use [`stop()`](https://rdrr.io/r/base/stop.html) for errors,
  [`warning()`](https://rdrr.io/r/base/warning.html) for warnings
- Handle `NA` values explicitly
- Document edge cases

``` r
#' @title Example function
#' @param x numeric vector
#' @return numeric vector
#' @export
#' @examples
#' my_function(c(1, 2, 3))
my_function <- function(x) {
  if (!is.numeric(x)) stop("x must be numeric")
  x * 2
}
```

## Testing

- Use testthat (\>= 3.0.0) framework
- Write tests for all exported functions
- Include tests for edge cases (NA values, empty inputs)
- Name test files `test-<function-name>.R`

``` r
test_that("my_function handles NA", {
  expect_identical(my_function(NA_real_), NA_real_)
})
```

## Dependencies

Current imports: `tibble`, `magrittr`, `stringr`, `dplyr`, `rlang`,
`purrr`

When adding new dependencies:

- Add to `Imports:` in DESCRIPTION
- Use `package::function()` notation in code
- Minimize new dependencies when possible

------------------------------------------------------------------------

## Common Tasks

**Adding a New Function:**

1.  Create R file in `R/` directory
2.  Write function with roxygen2 documentation
3.  Add `@export` tag for public functions
4.  Create test file in `tests/testthat/`
5.  Run `devtools::document()` to update docs
6.  Run `devtools::check()` to verify

**Fixing Bugs:**

1.  Add failing test that reproduces the bug
2.  Fix the bug in source code
3.  Verify test passes
4.  Ensure all other tests still pass

------------------------------------------------------------------------

## pkgdown Website Maintenance

The package website is built using pkgdown and deployed to GitHub Pages.

**IMPORTANT: Always update pkgdown references when functions change:**

- When adding a new exported function, update `_pkgdown.yml` if using
  custom reference sections
- When removing a function, remove it from `_pkgdown.yml` reference
  sections
- When renaming a function, update the name in `_pkgdown.yml`
- Run
  [`pkgdown::build_site()`](https://pkgdown.r-lib.org/reference/build_site.html)
  locally to verify the site builds correctly

**pkgdown Configuration:**

- `_pkgdown.yml` - Main configuration file
- `docs/` - Generated site (in .gitignore, do not commit)
- `.github/workflows/pkgdown.yaml` - CI workflow for building and
  deploying

**Updating Reference Organization:**

If `_pkgdown.yml` contains a `reference:` section with custom groupings:

``` yaml
reference:
- title: "Data Viewing"
  contents:
  - view_unique_col_entries
  - view_slice
- title: "Data Transformation"
  contents:
  - fix_excel_decimal_symbol_errors
```

Ensure all exported functions are listed in one of the groups.

------------------------------------------------------------------------

## Maintaining These Instructions

When updating copilot instructions, follow these best practices:

- Keep files under 250 lines (max 1000)
- Use headings, bullets, and clear sections
- Be direct with short, imperative rules
- Show code examples (correct and incorrect patterns)
- No external links (Copilot won’t follow them)
- No vague language like “be more accurate”
- Use `applyTo` frontmatter in topic-specific files

**What NOT to do:**

- ❌ Don’t include external links
- ❌ Don’t use vague language
- ❌ Don’t create long dense paragraphs
- ❌ Don’t try to change Copilot’s UX behavior
